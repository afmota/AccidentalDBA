<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>DBA Acidental</title>
</head>
<body>
	<img src="imagens/capa.jpg" alt="Capa do livro">
	<p>Troubleshooting SQL Server<br>
		A Guide for the Accidental DBA<br>
		By Jonathan Kehayias and Ted Krueger</p>
	<p>With a Foreword from Paul S. Randal</p>
	<p>First published by Simple Talk Publishing September 2011</p>
	<p>
		Direitos autorais de Jonathan Kehayias e Ted Krueger 2011<br>
		ISBN 978-1-906434-77-9<br>
		O direito de Jonathan Kehayias e Ted Krueger de serem identificados como autores desta obra foi afirmado por eles de acordo com o Copyright, Designs and Patents Act 1988.<br>
		Todos os direitos reservados. Nenhuma parte desta publicação pode ser reproduzida, armazenada ou introduzida em um sistema de recuperação, ou transmitida de qualquer forma ou por qualquer meio (eletrônico, mecânico, fotocópia, gravação ou outro) sem o consentimento prévio por escrito do editor. Qualquer pessoa que realizar qualquer ato não autorizado em relação a esta publicação poderá ser responsabilizada por processo criminal e reivindicações civis por danos. Este livro é vendido sob a condição de que não seja emprestado, revendido, alugado ou circulado de outra forma sem o consentimento prévio do editor, em qualquer forma que não seja a publicada, e sem uma condição semelhante, incluindo esta condição, sendo imposta ao editor subsequente.<br>
		Editado por Tony Davis<br>
		Revisão técnica e material adicional: Gail Shaw<br>
		Imagem da capa por Andy Martin<br>
		Diagramação e design por Matthew Tye & Gower Associates<br>
	</p>
	<h1>Table of Contents</h1>
Introduction
Who is this book for?
Code Examples

Chapter 1: A Performance Troubleshooting Methodology
Defining a Troubleshooting Methodology
Wait Statistics: the Basis for Troubleshooting
Virtual File Statistics
Performance Counters
Plan Cache Usage
Summary

Chapter 2: Disk I/O Configuration
Disk Configuration: Basic Considerations
Disk size vs. disk throughput
Random versus sequential I/O
Choosing the Right RAID Level
A brief overview of RAID configurations
Disk size and throughput considerations
Workload considerations
Direct Attached Storage vs. Storage Area Networks
Direct Attached Storage
Storage Area Networks
Diagnosing Disk I/O Issues
Common Disk I/O Problems
Sizing for capacity instead of I/O performance
Incorrect workload isolation
Incorrect partition alignment
Incorrect bandwidth using SAN configurations
Summary

Chapter 3: High CPU Utilization
Investigating CPU Pressure
Performance Monitor
SQL Trace
Dynamic Management Views
Common Causes of High CPU Usage
Missing indexes
Outdated statistics
Non-SARGable predicates
Implicit conversions
Parameter sniffing
Ad hoc non-parameterized queries
Inappropriate parallelism
TokenAndPermUserStore
Windows Server and BIOS power saving options
Summary
Additional Resources

Chapter 4: Memory Management
The Self-Tuning Database Engine
How SQL Server Allocates Memory
32-bit Virtual Address Space limitations
Using 64-bit SQL Server
Memory configuration options with 64-bit SQL Server
Diagnosing Memory Pressure
Memory-related counters
Memory-related DMVs
Common Memory-Related Problems
The SQL Server memory leak myth
Paging problems
OS instability due to Lock Pages in Memory
plus unlimited max server memory
App Domain is marked for unload due to memory pressure
Error 701 and FAILED_VIRTUAL_RESERVE
Over-provisioned virtual machines
Memory settings for multiple instances
Summary

Chapter 5: Missing Indexes
Index Selection and Design
Index key column order
Use of included columns
Index width
Identifying Missing Indexes
Workload analysis with the Database Engine Tuning Advisor
Missing index feature
Missing indexes on foreign keys
Identifying Unused Indexes
Identifying Duplicate Indexes
Summary

Chapter 6: Blocking
Locks and Concurrency (a Brief Review)
Lock modes
Lock types
Lock escalation
Concurrency and the transaction isolation levels
Latches and latch contention
Monitoring Blocking
Using sysprocesses (SQL Server 2000 and later)
Cumulative wait statistics with DBCC SQLPERF (waitstats)
Dynamic Management Views
Performance Monitor
Automated Detection and Notification of Blocking
The Sp_blocker_pss80 process
SQL Trace
Event notifications
Extended Events
Resolving Blocking
Bad database design
Inappropriate isolation level
Poorly written queries
Missing indexes
Poor application design
Outdated hardware
Hints, Trace Flags and Other Last Resorts
Locking hints
Summary

Chapter 7: Handling Deadlocks
The Lock Monitor
Capturing Deadlock Graphs
Trace Flag 1204
Trace Flag 1222
SQL Profiler XML Deadlock Graph event
Service Broker event notifications
WMI Provider for server events
Extended Events
Reading Deadlock Graphs
Interpreting Trace Flag 1204 deadlock graphs
Interpreting Trace Flag 1222 deadlock graphs
Interpreting XML deadlock graphs
Common types of deadlock and how to eliminate them
Bookmark lookup deadlock
Range scans caused by SERIALIZABLE isolation
Cascading constraint deadlocks
Intra-query parallelism deadlocks
Accessing objects in different orders
Handling Deadlocks to Prevent Errors
T-SQL TRY…CATCH blocks
Handling ADO.NET SqlExceptions in .NET code
Controlling Deadlock Behavior with Deadlock Priority
Summary

Chapter 8: Large or Full Transaction Log
How the Transaction Log Works
How SQL Server writes to the transaction log
Understanding log truncation
Sizing and growing the log
Diagnosing a Runaway Transaction Log
Excessive logging: index maintenance operations
Lack of log space reuse
Other possible causes of log growth
Handling a "Transaction Log Full" Error
Mismanagement or What Not To Do
Detach database, delete log file
Forcing log file truncation
Scheduled shrinking of the transaction log
Proper Log Management
Summary

Chapter 9: Truncated Tables, Dropped Objects and Other
Accidents Waiting to Happen
Example Case: The Missing Sales Order Data
Recovering Lost Data
Recovering from backup
Recovering without a backup
Finding the Culprit
Prevention is Better than Cure
Plan for recovery from all data losses
Implement a change control process
Implement an appropriate security model
Access control measures
Summary

Appendix: What to Do When All Else Fails
Microsoft Customer Support Services
Online Resources
Articles
Blogs
Forums
Hiring a Consultant
</body>
</html>